<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Listado y Edición de Productos</title>
</head>
<body>

    <!-- Mostrar mensajes de log o xorecto -->
    <div th:if="${mensaje}">
        <p style="color: green;" th:text="${mensaje}"></p>
    </div>
    <div th:if="${error}">
        <p style="color: red;" th:text="${error}"></p>
    </div>
    
    
    <h1>Listado y Edición de Productos</h1>

    <!-- Formulario para crear un nuevo producto -->
    <form th:action="@{/productos/guardarProducto}" th:object="${producto}" method="post" enctype="multipart/form-data" >
        <input type="text" th:field="*{nombre}" placeholder="Nombre del Producto" required/>
               <span th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}">Error</span>
  
        <input type="text" th:field="*{descripcion}" placeholder="Descripción" required/><br/>
        <input type="number" th:field="*{precio}" placeholder="Precio" required/><br/>
        <input type="number" th:field="*{stock}" placeholder="Stock" required/><br/>
            <!-- Campo para subir imagen -->
        <input type="file" name="imagen" accept="image/*"/><br/>
         <span th:if="${#fields.hasErrors('imagen')}" th:errors="*{imagen}">Error de imagen</span>
    
        <!-- Dropdowns para seleccionar categoría y marca -->
        <select th:field="*{categoria.idCategoria}" required>
            <option value="" disabled selected>Selecciona una categoría</option>
            <option th:each="categoria : ${categorias}" th:value="${categoria.idCategoria}" th:text="${categoria.nombre}"></option>
        </select><br/>
        
        <select th:field="*{marca.idMarca}" required>
            <option value="" disabled selected>Selecciona una marca</option>
            <option th:each="marca : ${marcas}" th:value="${marca.idMarca}" th:text="${marca.nombre}"></option>
        </select><br/>
        
        <button type="submit">Guardar</button>
    </form>

    <!-- Tabla de listado de productos -->
    <table class="product-display-table">
        <thead>
            <tr>
                <th>Nombre del Producto</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Imagen</th>
                <th>Categoría</th>
                <th>Marca</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="producto : ${listProducts}">
                <td th:text="${producto.nombre}"></td>
                <td th:text="${producto.descripcion}"></td>
                <td th:text="${producto.precio}"></td>
                <td th:text="${producto.stock}"></td>
                 <td>
                    <img th:src="@{${producto.imagen}}" alt="Imagen del Producto" width="100" height="100" />
                </td>
                <td th:text="${producto.categoria.nombre}"></td>
                <td th:text="${producto.marca.nombre}"></td>
                <td>
                    <a th:href="@{/productos/editar/{id}(id=${producto.idProducto})}" class="btn btn-primary">Actualizar</a>
                    <a th:href="@{/productos/eliminar/{id}(id=${producto.idProducto})}" class="btn btn-danger">Eliminar</a>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>

